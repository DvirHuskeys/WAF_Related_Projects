<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>5</epicId>
    <storyId>3</storyId>
    <title>Rule Transparency Brief Export</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-11-30</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/5-3-rule-transparency-brief-export.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>As executives</asA>
    <iWant>I want to export a narrative comparing vendor rules for a domain</iWant>
    <soThat></soThat>
    <tasks>      <![CDATA[
      - [ ] Template + renderer (AC: 1–3)  
  - [ ] Create Markdown template pulling from rule comparison data + notes.  
  - [ ] Integrate with export helper for PDF option.  
- [ ] UI integration (AC: 1–4)  
  - [ ] Add “Export Rule Brief” button to Rule Studio / Drawer.  
  - [ ] Provide preview + download link.  
- [ ] CLI option (AC: 5)  
  - [ ] Add optional script (or extend existing export CLI).  
- [ ] Documentation (AC: 5)  
  - [ ] Update README with instructions.
      ]]></tasks>
  </story>

  <acceptanceCriteria>      <![CDATA[
      1. Given at least two vendor rules exist for the selected domain, when I click “Export Rule Brief” then a Markdown file saves to `docs/reports/<domain>-rule-brief-<timestamp>.md` summarizing: vendor comparison table, detection pattern differences, mitigation notes, freshness metadata, annotations (Story 4.3), and recommended messaging.
2. Brief includes citations referencing rule sync job ID and note authors.
3. Option to render PDF similar to Story 5.2.
4. UI preview is available prior to download; success toast references file path.
5. README documents how to run via CLI or Streamlit.
      ]]></acceptanceCriteria>

  <artifacts>
    <docs>      <doc path="docs/sprint-artifacts/5-3-rule-transparency-brief-export.md" title="Rule Transparency Brief Export" section="Story Draft" snippet="As executives, I want to export a narrative comparing vendor rules for a domain, so I can justify renewals or migrations with evidence from Rule Transparency Studio." />
      <doc path="docs/epics.md" title="WAF Security - Epic Breakdown" section="Story 5.3" snippet="As executives, we want a brief comparing vendor rules for a domain so we can justify renewal or migrations. **Acceptance Criteria** • **Given** at least two vendor rules exist • **When** I run “Export Rule Brief” • **Then** Markdown includes comparison table, key differences, freshness warnings, and recommended messaging, satisfying FR13–FR14…" />
      <doc path="docs/prd.md" title="Product Requirements Document" section="Executive Summary" snippet="WAF Security establishes a local-first “insight spine” that combines WAFtotal (vendor-agnostic managed-rule transparency) with GTM Radar (domain fingerprinting + storytelling) so every security, architecture, and GTM conversation starts with evidence instead of guesswork. By harvesting domain signals, normalizing Cloudflare/AWS/Akamai rule packs, and…" />
      <doc path="docs/architecture.md" title="Architecture Specification" section="Project Context &amp; Goals" snippet="- **Deployment Reality:** Local-first sandbox meant to run entirely on a lone laptop (Streamlit UI, FastAPI services, DuckDB file storage). No cloud infra, no Postgres/React rewrite—lightweight scripts + HTML artifacts are sufficient so iteration stays fast. - **Primary Outcomes:** 1. Fingerprint domains (CLI + FastAPI) and persist results in DuckDB. 2.…" />
      <doc path="docs/product-brief-WAF Security-2025-11-30.md" title="Product Brief" section="Executive Summary" snippet="WAF Security is building an internal “insight spine” that fuses two sibling ideas—**WAFtotal**, a vendor-agnostic managed-rule transparency experience, and **GTM Radar**, a domain fingerprinting + storytelling engine for sales and marketing teams. Together they deliver three promises: (1) decode any prospect’s WAF/CDN posture in minutes, (2) expose…" />
      <doc path="docs/research-market-2025-11-30.md" title="Market/Domain Research" section="Executive Summary" snippet="- The global web application firewall (WAF) market is scaling aggressively: SNS Insider pegs it at **USD 6.35 B in 2023 with a path to USD 28.6 B by 2032 (18.2% CAGR)**, while ResearchAndMarkets estimates **USD 6.22 B in 2024 growing to USD 19.2 B by 2033 (13.3% CAGR)**, giving us a triangulated TAM envelope of USD 19–29 B within a decade. - [Source: SNS…" /></docs>
    <code>      <code path="ui/app.py" kind="ui" symbol="WAF Security Lab layout" lines="1-56" reason="Base UI for radar table + persona hooks." />
      <code path="backend/services/persona.py" kind="service" symbol="list_personas" lines="8-48" reason="Supplies persona metadata for reporting exports." />
      <code path="backend/services/storage.py" kind="service" symbol="list_domains helpers" lines="49-68" reason="Provides data retrieval for radar tables and report exports." /></code>
    <dependencies>      <dependency name="streamlit" version="1.40.1" scope="ui" />
      <dependency name="fastapi" version="0.115.2" scope="api" />
      <dependency name="httpx" version="0.27.0" scope="api" /></dependencies>
  </artifacts>

  <constraints>      <![CDATA[
      - Reuses output from Stories 4.2 and 4.3; ensure the export handles stale metadata (Story 4.4).  
- Summaries should echo persona hooks for CISO Cassandra.

### Project Structure Notes

- Template under `docs/templates/`; use same export helper as Story 5.2.

### References

- [Source: docs/epics.md#story-53-rule-transparency-brief-export]  
- [Source: docs/prd.md#functional-requirements FR13, FR14]
      ]]></constraints>
  <interfaces>      <interface name="rule_sync adapter runner" kind="CLI command" signature="python scripts/rule_sync/run.py cloudflare --source data/rules/cloudflare_sample.json" path="scripts/rule_sync/run.py" /></interfaces>
  <tests>
    <standards>      <![CDATA[
      - [x] domain_enrich.py run Command: `python scripts/domain_enrich.py data/samples/domains.csv` Result: Generated four enriched records in DuckDB, offline heuristics used. - [x] rule_sync/run.py Command: `python scripts/rule_sync/run.py cloudflare --source data/rules/cloudflare_sample.json` Result: Loaded two sample managed rules. - [x] API schema test…
      ]]></standards>
    <locations>      <![CDATA[
      tests/, scripts/, ui/
      ]]></locations>
    <ideas>      <![CDATA[
      AC1: Verify Given at least two vendor rules exist for the selected domain, when I click “Export Rule Brief” then a Markdown file saves to `docs/reports/<domain>-rule-brief-<timestamp>.md` summarizing: vendor comparison table, detection pattern differences, mitigation notes, freshness metadata, annotations (Story 4.3), and recommended messaging.; AC2: Verify Brief includes citations referencing rule sync job ID and note authors.; AC3: Verify Option to render PDF similar to Story 5.2.; AC4: Verify UI preview is available prior to download; success toast references file path.; AC5: Verify README documents how to run via CLI or Streamlit.
      ]]></ideas>
  </tests>
</story-context>
